{{- range $_, $https := .Values.app.ingress.https }}
{{- if eq $https.managedBy "cert-manager" }}
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: {{ $https.secretName | quote }}
  labels:
    {{- if $.Values.app.id }}
    {{ $.Values.app.group }}/app-id: {{ $.Values.app.id | quote }}
    {{- end }}
    {{ $.Values.app.group }}/app-name: {{ $.Values.app.name | quote }}
    {{- with (last $.Values.app.deployments) }}
    {{ $.Values.app.group }}/app-deployment-version: {{ .version | quote }}
    {{- end }}
spec:
  secretName: {{ $https.secretName | quote }}
  secretTemplate:
    labels:
      {{- if $.Values.app.id }}
      {{ $.Values.app.group }}/app-id: {{ $.Values.app.id | quote }}
      {{- end }}
      {{ $.Values.app.group }}/app-name: {{ $.Values.app.name | quote }}
  dnsNames:
    - {{ $https.cname }}
  issuerRef:
    name: {{ $.Values.ingressController.clusterIssuer }}
    kind: ClusterIssuer
---
{{ end }}
{{ end }}
